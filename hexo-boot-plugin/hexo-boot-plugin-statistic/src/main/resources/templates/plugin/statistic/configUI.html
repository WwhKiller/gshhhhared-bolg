<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, initial-scale=1, shrink-to-fit=no">
    <div th:replace="~{admin/common :: common-link}"></div>
    <style>
        .block-content {
            min-height: 100px;
        }
        .visit-block {
            position: relative;
        }
        .visit-label {
            position: absolute;
            right: 20px;
            bottom: 20px;
        }
    </style>
</head>
<body>

<div class="content">
    <div class="block">
        <div class="block-content">
            <div class="row justify-content-center py-20">
                <div class="col-6 col-xl-3">
                    <a class="block block-link-shadow text-right bg-primary text-white visit-block">
                        <div class="block-content block-content-full clearfix">
                            <div class="float-left mt-10 d-none d-sm-block">
                                <i class="fa fa-desktop fa-3x text-body-bg-dark"></i>
                            </div>
                            <div id="todayPV">正在加载...</div>
                            <div class="font-size-sm font-w600 text-uppercase text-white visit-label">当日 PV</div>
                        </div>
                    </a>
                </div>
                <div class="col-6 col-xl-3">
                    <a class="block block-link-shadow text-right bg-corporate text-white visit-block">
                        <div class="block-content block-content-full clearfix">
                            <div class="float-left mt-10 d-none d-sm-block">
                                <i class="fa fa-user fa-3x text-body-bg-dark"></i>
                            </div>
                            <div id="todayUV">正在加载...</div>
                            <div class="font-size-sm font-w600 text-uppercase text-white visit-label">当日 UV</div>
                        </div>
                    </a>
                </div>
                <div class="col-6 col-xl-3">
                    <a class="block block-link-shadow text-right bg-warning text-white visit-block">
                        <div class="block-content block-content-full clearfix">
                            <div class="float-left mt-10 d-none d-sm-block">
                                <i class="fa fa-desktop fa-3x text-body-bg-dark"></i>
                            </div>
                            <div id="totalPV">正在加载...</div>
                            <div class="font-size-sm font-w600 text-uppercase text-white visit-label">总 PV</div>
                        </div>
                    </a>
                </div>
                <div class="col-6 col-xl-3">
                    <a class="block block-link-shadow text-right bg-flat text-white visit-block">
                        <div class="block-content block-content-full clearfix">
                            <div class="float-left mt-10 d-none d-sm-block">
                                <i class="fa fa-user fa-3x text-body-bg-dark"></i>
                            </div>
                            <div id="totalUV" style="word-wrap: break-word;word-break: normal;">正在加载...</div>
                            <div class="font-size-sm font-w600 text-uppercase text-white visit-label">总 UV</div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
        <div class="block-content">
            <div class="row justify-content-center py-20">
                <div class="col-12 col-xl-12">
                    <div class="block-header block-header-default">
                        <h3 class="block-title">PV与UV统计</h3>
                    </div>
                    <div class="block-content">
                        <div id="pvUvArea" style="min-height:355px;"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="block-content">
            <div class="row justify-content-center py-20">
                <div class="col-6 col-xl-6">
                    <div class="block-header block-header-default">
                        <h3 class="block-title">页面访问统计</h3>
                    </div>
                    <div class="block-content">
                        <div id="pageChart" style="min-height: 335px"></div>
                    </div>
                </div>
                <div class="col-6 col-xl-6">
                    <div class="block-header block-header-default">
                        <h3 class="block-title">城市访问统计</h3>
                    </div>
                    <div class="block-content">
                        <div id="cityChart" style="min-height: 335px"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script th:src="@{'/admin/assets/js/plugins/echarts/dist/echarts.min.js'}"></script>
    <div th:replace="~{admin/common :: common-script}"></div>
</div>
<script type="text/javascript" th:inline="javascript">

    let VisitInfo = {
        init: function() {
            VisitInfo.getSitePageInfo();
            VisitInfo.createPVAndUV();
            VisitInfo.createCity();
            VisitInfo.createPage();
        },
        getSitePageInfo: function() {
            $.hexo.action.sendRequest({
                url: [[${baseUrl}]] + "/getSitePageInfo.json",
                callback: function (resp) {
                    if (resp.success) {
                        let data = resp.data;
                        for (let key in data) {
                            $("#" + key).text(data[key]);
                        }
                    }
                }
            });
        },
        createPVAndUV: function() {
            const labelOption = {
                show: true,
                position: 'insideBottom',
                distance: 15,
                align: 'center',
                verticalAlign: 'middle',
                formatter: '{c}  {name|{a}}',
                fontSize: 16,
                rich: {
                    name: {}
                }
            };
            let pvUvChart = echarts.init(document.getElementById("pvUvArea"));
            pvUvChart.setOption({
                title: {
                    text: '近七天访问人数'
                },
                tooltip: {},
                legend: {
                    data: ['pv', 'uv']
                },
                xAxis: [
                    {
                        type: 'category',
                        axisTick: { show: false },
                        data: []
                    }
                ],
                yAxis: [
                    {
                        type: 'value'
                    }
                ],
                series: [
                    {
                        name: 'pv',
                        type: 'bar',
                        barGap: 0,
                        label: labelOption,
                        emphasis: {
                            focus: 'series'
                        },
                        data: []
                    },
                    {
                        name: 'uv',
                        type: 'bar',
                        label: labelOption,
                        emphasis: {
                            focus: 'series'
                        },
                        data: []
                    }
                ]
            });
            pvUvChart.showLoading();

            $.getJSON([[${baseUrl}]] + "/getLatestVisitInfo.json", function (resp) {
                pvUvChart.hideLoading();
                if (resp.success) {
                    pvUvChart.setOption({
                        xAxis: {
                            data: resp.data.dateList
                        },
                        series: [
                            {
                                data: resp.data.pvList
                            },
                            {
                                data: resp.data.uvList
                            }
                        ]
                    });
                }
            });
        },
        createPage: function() {
            let pageChart = echarts.init(document.getElementById("pageChart"));
            pageChart.setOption({
                title: {
                    text: '访问页面次数top10',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item'
                },
                legend: {
                    orient: 'vertical',
                    left: 'left'
                },
                series: [
                    {
                        type: 'pie',
                        radius: '50%',
                        data: [],
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            });

            pageChart.showLoading();

            $.getJSON([[${baseUrl}]] + "/getPageDataByTop10.json", function (resp) {
                pageChart.hideLoading();
                if (resp.success) {
                    pageChart.setOption({
                        series: [{
                            data: resp.data.pageData
                        }]
                    });
                }
            });
        },
        createCity: function() {
            let cityChart = echarts.init(document.getElementById("cityChart"));
            cityChart.setOption({
                title: {
                    text: '访问城市来源top10',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item'
                },
                legend: {
                    orient: 'vertical',
                    left: 'left'
                },
                series: [
                    {
                        type: 'pie',
                        radius: '50%',
                        data: [],
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            });
            cityChart.showLoading();

            $.getJSON([[${baseUrl}]] + "/getCityDataByTop10.json", function (resp) {
                cityChart.hideLoading();
                if (resp.success) {
                    cityChart.setOption({
                        series: [{
                            data: resp.data.cityData
                        }]
                    });
                }
            });
        }
    };

    VisitInfo.init();

</script>
</body>
</html>